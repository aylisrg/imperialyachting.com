# Analytics Improvement System ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

**–°–∞–π—Ç**: imperialyachting.com ‚Äî Next.js 16, React 19, Supabase, Vercel, Tailwind
**GA**: G-BQPZ2WJWWL (gtag.js), —Å–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ page views
**–¢–æ—á–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏**: WhatsApp, Contact form, Phone, Email, Fleet page ‚Üí yacht detail
**–ê–¥–º–∏–Ω–∫–∞**: `/admin` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–ª–æ—Ç–æ–º —è—Ö—Ç

---

## 1. –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Google      ‚îÇ    ‚îÇ  API Route       ‚îÇ    ‚îÇ  Claude API   ‚îÇ    ‚îÇ  Supabase    ‚îÇ
‚îÇ  Analytics   ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  /api/analytics  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  (–ê–Ω–∞–ª–∏–∑)     ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  (–•—Ä–∞–Ω–µ–Ω–∏–µ)  ‚îÇ
‚îÇ  Data API    ‚îÇ    ‚îÇ  collect + analyze‚îÇ    ‚îÇ               ‚îÇ    ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ                                            ‚îÇ
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ  –¢—Ä–∏–≥–≥–µ—Ä—ã:  ‚îÇ                              ‚îÇ  –í—ã–≤–æ–¥:     ‚îÇ
                   ‚îÇ  ‚Ä¢ Cron GH  ‚îÇ                              ‚îÇ  ‚Ä¢ /admin/  ‚îÇ
                   ‚îÇ    Actions  ‚îÇ                              ‚îÇ    analytics‚îÇ
                   ‚îÇ  ‚Ä¢ –ö–Ω–æ–ø–∫–∞   ‚îÇ                              ‚îÇ  ‚Ä¢ Telegram ‚îÇ
                   ‚îÇ    –≤ –∞–¥–º–∏–Ω–∫–µ‚îÇ                              ‚îÇ    –±–æ—Ç      ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 2. –§–∞–∑–∞ 1 ‚Äî Enhanced GA Event Tracking (—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)

–°–µ–π—á–∞—Å GA —Å–æ–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ page views. –î–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –Ω—É–∂–Ω–æ —Ç—Ä–µ–∫–∞—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è.

### –ù–æ–≤—ã–π –º–æ–¥—É–ª—å: `src/lib/analytics.ts`

```ts
// –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ gtag –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–π
export function trackEvent(action: string, params: Record<string, string>) { ... }
```

**–ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –Ω–∞—á–Ω—ë–º —Ç—Ä–µ–∫–∞—Ç—å:**

| –°–æ–±—ã—Ç–∏–µ | –ì–¥–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç | GA Event Name |
|---------|----------------|---------------|
| –ö–ª–∏–∫ WhatsApp | Hero, CTA, Fleet, Header | `click_whatsapp` |
| –ö–ª–∏–∫ "Contact Us" | Hero, CTA | `click_contact` |
| –ö–ª–∏–∫ –Ω–∞ —è—Ö—Ç—É | Fleet page, FleetPreview | `click_yacht` |
| –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã | Contact page | `submit_inquiry` |
| –ö–ª–∏–∫ —Ç–µ–ª–µ—Ñ–æ–Ω | CTA, Footer, Header | `click_phone` |
| –ö–ª–∏–∫ email | CTA, Footer | `click_email` |
| –°–∫—Ä–æ–ª–ª –¥–æ CTA —Å–µ–∫—Ü–∏–∏ | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ | `view_cta_section` |
| –ö–ª–∏–∫ "Explore Fleet" | Hero | `click_explore_fleet` |
| –ö–ª–∏–∫ –Ω–∞ destination | Destinations page | `click_destination` |
| Promo popup interaction | PromoPopup | `promo_popup_interact` |

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** (–¥–æ–±–∞–≤–ª—è–µ–º `onClick` ‚Üí `trackEvent`):
- `src/components/ui/Button.tsx` ‚Äî –±–∞–∑–æ–≤—ã–π —Ç—Ä–µ–∫–∏–Ω–≥ –¥–ª—è CTA-–∫–Ω–æ–ø–æ–∫
- `src/components/sections/Hero.tsx`
- `src/components/sections/CTASection.tsx`
- `src/components/gallery/FleetCard.tsx`
- `src/components/forms/ContactForm.tsx`
- `src/components/promo/PromoPopup.tsx`
- `src/components/layout/Header.tsx`
- `src/components/layout/Footer.tsx`

---

## 3. –§–∞–∑–∞ 2 ‚Äî –ë—ç–∫–µ–Ω–¥: –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ GA

### 3.1 Google Analytics Data API (GA4)

–ë—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Google Analytics Data API v1** (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π) –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ credentials:**
- Google Cloud Service Account —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ GA property
- Env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `GOOGLE_ANALYTICS_PROPERTY_ID`, `GOOGLE_SERVICE_ACCOUNT_KEY` (JSON)

**NPM-–ø–∞–∫–µ—Ç**: `@google-analytics/data` (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç)

### 3.2 API Route: `src/app/api/analytics/collect/route.ts`

–°–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π:

```ts
// –ö–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É GA Data API:
const metrics = [
  'sessions',           // –û–±—â–µ–µ —á–∏—Å–ª–æ —Å–µ—Å—Å–∏–π
  'totalUsers',         // –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  'newUsers',           // –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  'bounceRate',         // Bounce rate
  'averageSessionDuration', // –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏
  'screenPageViews',    // –ü—Ä–æ—Å–º–æ—Ç—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü
  'conversions',        // –ö–æ–Ω–≤–µ—Ä—Å–∏–∏ (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤ GA)
  'eventCount',         // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π
];

const dimensions = [
  'pagePath',           // –ü–æ –∫–∞–∫–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
  'deviceCategory',     // Desktop / Mobile / Tablet
  'sessionSource',      // –ò—Å—Ç–æ—á–Ω–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞
  'sessionMedium',      // –ö–∞–Ω–∞–ª —Ç—Ä–∞—Ñ–∏–∫–∞
  'country',            // –ì–µ–æ–≥—Ä–∞—Ñ–∏—è
  'eventName',          // –ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è (–Ω–∞—à–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ)
];
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: JSON-–æ–±—ä–µ–∫—Ç —Å –ø–æ–ª–Ω—ã–º —Å—Ä–µ–∑–æ–º –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∑–∞ –Ω–µ–¥–µ–ª—é.

### 3.3 –ó–∞—â–∏—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞

- –ü—Ä–æ–≤–µ—Ä–∫–∞ `Authorization: Bearer <ANALYTICS_CRON_SECRET>` header
- –°–µ–∫—Ä–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ env, –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∏–∑ GitHub Actions –∏ –∏–∑ –∞–¥–º–∏–Ω–∫–∏

---

## 4. –§–∞–∑–∞ 3 ‚Äî AI-–∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ Claude API

### 4.1 API Route: `src/app/api/analytics/analyze/route.ts`

–ü–æ–ª—É—á–∞–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Claude API —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º.

**System prompt –¥–ª—è Claude** (—Å—É—Ç—å):

```
–¢—ã ‚Äî CRO-–∞–Ω–∞–ª–∏—Ç–∏–∫ –¥–ª—è —Å–∞–π—Ç–∞ –∞—Ä–µ–Ω–¥—ã —è—Ö—Ç –≤ –î—É–±–∞–µ (imperialyachting.com).
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Google Analytics –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å:

1. SUMMARY: –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é (3-5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π)
2. KEY_METRICS: –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å —Ç—Ä–µ–Ω–¥–æ–º ‚Üë‚Üì vs –ø—Ä–æ—à–ª–∞—è –Ω–µ–¥–µ–ª—è
3. HYPOTHESES: 3-5 –≥–∏–ø–æ—Ç–µ–∑ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (high/medium/low)
   - –ö–∞–∂–¥–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞: –ø—Ä–æ–±–ª–µ–º–∞ ‚Üí –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Üí –æ–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç
4. QUICK_WINS: 1-3 –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞ –¥–µ–Ω—å
5. PAGE_INSIGHTS: –ê–Ω–∞–ª–∏–∑ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º (landing, fleet, contact)
6. TRAFFIC_ANALYSIS: –û—Ç–∫—É–¥–∞ –∏–¥—ë—Ç —Ç—Ä–∞—Ñ–∏–∫, –∫–∞–∫–∏–µ –∫–∞–Ω–∞–ª—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ª—É—á—à–µ

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON.
```

**ENV**: `ANTHROPIC_API_KEY`
**NPM-–ø–∞–∫–µ—Ç**: `@anthropic-ai/sdk`

### 4.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ Claude (—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω)

```ts
interface AnalyticsReport {
  id: string;
  period_start: string;          // "2026-02-17"
  period_end: string;            // "2026-02-24"

  // –°—ã—Ä—ã–µ –º–µ—Ç—Ä–∏–∫–∏
  raw_metrics: {
    sessions: number;
    users: number;
    new_users: number;
    bounce_rate: number;
    avg_session_duration: number;
    page_views: number;
    whatsapp_clicks: number;
    contact_clicks: number;
    inquiry_submissions: number;
    yacht_clicks: number;
    phone_clicks: number;
  };

  // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ–π
  trends: Record<string, { value: number; change_percent: number; direction: 'up' | 'down' | 'flat' }>;

  // AI-–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
  summary: string;
  hypotheses: Array<{
    id: string;
    title: string;
    problem: string;
    solution: string;
    expected_impact: string;
    priority: 'high' | 'medium' | 'low';
    category: 'ux' | 'content' | 'technical' | 'marketing';
    status: 'new' | 'accepted' | 'rejected' | 'implemented' | 'tested';
  }>;
  quick_wins: Array<{ title: string; description: string; effort: 'low' | 'medium' }>;
  page_insights: Array<{ page: string; views: number; bounce_rate: number; insight: string }>;
  traffic_analysis: { summary: string; top_sources: Array<{ source: string; sessions: number; conversion_rate: number }> };

  created_at: string;
  status: 'collecting' | 'analyzing' | 'complete' | 'error';
}
```

---

## 5. –§–∞–∑–∞ 4 ‚Äî Supabase: –•—Ä–∞–Ω–µ–Ω–∏–µ

### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã

```sql
-- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã
CREATE TABLE analytics_reports (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  period_start DATE NOT NULL,
  period_end DATE NOT NULL,
  raw_metrics JSONB NOT NULL,           -- –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ GA
  trends JSONB,                          -- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ–π
  summary TEXT,                          -- AI-—Å–≤–æ–¥–∫–∞
  page_insights JSONB,                   -- –ê–Ω–∞–ª–∏–∑ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
  traffic_analysis JSONB,                -- –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞
  quick_wins JSONB,                      -- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
  status TEXT DEFAULT 'collecting',      -- collecting ‚Üí analyzing ‚Üí complete ‚Üí error
  error_message TEXT,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- –ì–∏–ø–æ—Ç–µ–∑—ã/—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ ‚Äî –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å)
CREATE TABLE analytics_hypotheses (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  report_id UUID REFERENCES analytics_reports(id) ON DELETE CASCADE,
  title TEXT NOT NULL,
  problem TEXT NOT NULL,
  solution TEXT NOT NULL,
  expected_impact TEXT,
  priority TEXT CHECK (priority IN ('high', 'medium', 'low')),
  category TEXT CHECK (category IN ('ux', 'content', 'technical', 'marketing')),
  status TEXT DEFAULT 'new' CHECK (status IN ('new', 'accepted', 'rejected', 'implemented', 'tested')),
  notes TEXT,                            -- –ó–∞–º–µ—Ç–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);
```

---

## 6. –§–∞–∑–∞ 5 ‚Äî –¢—Ä–∏–≥–≥–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞

### 6.1 GitHub Actions (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π cron)

**–§–∞–π–ª**: `.github/workflows/analytics-weekly.yml`

```yaml
name: Weekly Analytics Report
on:
  schedule:
    - cron: '0 8 * * 1'   # –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 8:00 UTC (12:00 Dubai)
  workflow_dispatch:        # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏–∑ GitHub UI

jobs:
  collect-and-analyze:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger analytics collection
        run: |
          curl -X POST https://imperialyachting.com/api/analytics/collect \
            -H "Authorization: Bearer ${{ secrets.ANALYTICS_CRON_SECRET }}" \
            -H "Content-Type: application/json"
```

### 6.2 –ö–Ω–æ–ø–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/admin/analytics` ‚Äî –∫–Ω–æ–ø–∫–∞ "Generate Report Now" –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

---

## 7. –§–∞–∑–∞ 6 ‚Äî UI: –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: `/admin/analytics`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```
/admin/analytics
‚îú‚îÄ‚îÄ Dashboard (—Ç–µ–∫—É—â–∏–π –æ—Ç—á—ë—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–∫–∞—Ä—Ç–æ—á–∫–∏ —Å —Ç—Ä–µ–Ω–¥–∞–º–∏ ‚Üë‚Üì)
‚îÇ   ‚îú‚îÄ‚îÄ AI-—Å–≤–æ–¥–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é
‚îÇ   ‚îú‚îÄ‚îÄ –¢–æ–ø-—Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ   ‚îî‚îÄ‚îÄ –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
‚îú‚îÄ‚îÄ –ì–∏–ø–æ—Ç–µ–∑—ã
‚îÇ   ‚îú‚îÄ‚îÄ –°–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É/–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
‚îÇ   ‚îú‚îÄ‚îÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å (new ‚Üí accepted ‚Üí implemented ‚Üí tested)
‚îÇ   ‚îî‚îÄ‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫
‚îú‚îÄ‚îÄ –ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á—ë—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ –°–ø–∏—Å–æ–∫ –ø—Ä–æ—à–ª—ã—Ö –Ω–µ–¥–µ–ª—å —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
‚îî‚îÄ‚îÄ –ö–Ω–æ–ø–∫–∞ "Generate Report Now"
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `src/app/admin/analytics/page.tsx` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `src/app/admin/analytics/components/MetricsCards.tsx` ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∏ KPI
- `src/app/admin/analytics/components/HypothesesList.tsx` ‚Äî —Å–ø–∏—Å–æ–∫ –≥–∏–ø–æ—Ç–µ–∑
- `src/app/admin/analytics/components/ReportHistory.tsx` ‚Äî –∏—Å—Ç–æ—Ä–∏—è
- `src/app/admin/analytics/components/TrafficChart.tsx` ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞

**–ù–∞–≤–∏–≥–∞—Ü–∏—è**: –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É "Analytics" –≤ AdminHeader.

---

## 8. –§–∞–∑–∞ 7 ‚Äî Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### API Route: `src/app/api/analytics/notify/route.ts`

–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É –≤ Telegram.

**ENV**: `TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID`

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
üìä –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç Imperial Yachting
–ü–µ—Ä–∏–æ–¥: 17 Feb ‚Äì 24 Feb 2026

üìà –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
‚Ä¢ Sessions: 1,234 (+12% ‚Üë)
‚Ä¢ Bounce Rate: 45% (-3% ‚Üì)
‚Ä¢ WhatsApp clicks: 89 (+25% ‚Üë)
‚Ä¢ Contact form: 12 (+8% ‚Üë)

üí° –¢–æ–ø-3 –≥–∏–ø–æ—Ç–µ–∑—ã:
1. [HIGH] –î–æ–±–∞–≤–∏—Ç—å sticky CTA –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö ‚Äî bounce rate –Ω–∞ mobile –Ω–∞ 20% –≤—ã—à–µ
2. [MED] A/B —Ç–µ—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ Hero —Å–µ–∫—Ü–∏–∏ ‚Äî CTR –Ω–∞ "Explore Fleet" < 3%
3. [MED] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å fleet —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Äî –≤—ã—Å–æ–∫–∏–π exit rate

üîó –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç: imperialyachting.com/admin/analytics
```

---

## 9. –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã)

```
src/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ analytics.ts                          # trackEvent helper (—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)
‚îÇ   ‚îî‚îÄ‚îÄ analytics/
‚îÇ       ‚îú‚îÄ‚îÄ ga-client.ts                      # Google Analytics Data API –∫–ª–∏–µ–Ω—Ç
‚îÇ       ‚îú‚îÄ‚îÄ claude-analyzer.ts                # Claude API –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
‚îÇ       ‚îú‚îÄ‚îÄ telegram-notifier.ts              # Telegram –±–æ—Ç
‚îÇ       ‚îî‚îÄ‚îÄ types.ts                          # –¢–∏–ø—ã –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤ –∏ –≥–∏–ø–æ—Ç–µ–∑
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/analytics/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ collect/route.ts                  # –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ GA
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analyze/route.ts                  # AI-–∞–Ω–∞–ª–∏–∑ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ collect)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notify/route.ts                   # Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reports/route.ts                  # GET ‚Äî —Å–ø–∏—Å–æ–∫ –æ—Ç—á—ë—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hypotheses/[id]/route.ts          # PATCH ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≥–∏–ø–æ—Ç–µ–∑—ã
‚îÇ   ‚îî‚îÄ‚îÄ admin/analytics/
‚îÇ       ‚îú‚îÄ‚îÄ page.tsx                           # –î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
‚îÇ       ‚îî‚îÄ‚îÄ components/
‚îÇ           ‚îú‚îÄ‚îÄ MetricsCards.tsx
‚îÇ           ‚îú‚îÄ‚îÄ HypothesesList.tsx
‚îÇ           ‚îú‚îÄ‚îÄ ReportHistory.tsx
‚îÇ           ‚îî‚îÄ‚îÄ TrafficChart.tsx
.github/
‚îî‚îÄ‚îÄ workflows/
    ‚îî‚îÄ‚îÄ analytics-weekly.yml                   # Cron job
```

---

## 10. Env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–Ω–æ–≤—ã–µ)

```env
# Google Analytics Data API
GOOGLE_ANALYTICS_PROPERTY_ID=        # GA4 property ID (—á–∏—Å–ª–æ–≤–æ–π)
GOOGLE_SERVICE_ACCOUNT_KEY=          # JSON key –æ—Ç Service Account (base64)

# Claude API
ANTHROPIC_API_KEY=                   # –ö–ª—é—á Anthropic API

# Cron security
ANALYTICS_CRON_SECRET=               # –°–µ–∫—Ä–µ—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ cron-–∑–∞–ø—Ä–æ—Å–æ–≤

# Telegram notifications
TELEGRAM_BOT_TOKEN=                  # –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
TELEGRAM_CHAT_ID=                    # ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```

---

## 11. NPM-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–Ω–æ–≤—ã–µ)

```
@google-analytics/data   ‚Äî –ö–ª–∏–µ–Ω—Ç GA Data API v1
@anthropic-ai/sdk        ‚Äî –ö–ª–∏–µ–Ω—Ç Claude API
```

---

## 12. –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –®–∞–≥ | –ß—Ç–æ –¥–µ–ª–∞–µ–º | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
|-----|-----------|-------------|
| 1 | `src/lib/analytics.ts` ‚Äî event tracking helper | ‚Äî |
| 2 | –î–æ–±–∞–≤–ª—è–µ–º trackEvent –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (Button, Hero, CTA, FleetCard, etc.) | –®–∞–≥ 1 |
| 3 | SQL –º–∏–≥—Ä–∞—Ü–∏—è ‚Äî —Å–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase + –æ–±–Ω–æ–≤–ª—è–µ–º types.ts | ‚Äî |
| 4 | `src/lib/analytics/types.ts` ‚Äî —Ç–∏–ø—ã | ‚Äî |
| 5 | `src/lib/analytics/ga-client.ts` ‚Äî –∫–ª–∏–µ–Ω—Ç GA Data API | ‚Äî |
| 6 | `src/lib/analytics/claude-analyzer.ts` ‚Äî AI –∞–Ω–∞–ª–∏–∑ | ‚Äî |
| 7 | `src/app/api/analytics/collect/route.ts` ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å–±–æ—Ä–∞ | –®–∞–≥–∏ 4-6 |
| 8 | `src/app/api/analytics/reports/route.ts` ‚Äî API –¥–ª—è —á—Ç–µ–Ω–∏—è | –®–∞–≥ 3 |
| 9 | `src/app/api/analytics/hypotheses/[id]/route.ts` ‚Äî PATCH —Å—Ç–∞—Ç—É—Å–∞ | –®–∞–≥ 3 |
| 10 | `/admin/analytics` ‚Äî UI –¥–∞—à–±–æ—Ä–¥ | –®–∞–≥–∏ 7-9 |
| 11 | `src/lib/analytics/telegram-notifier.ts` ‚Äî Telegram –±–æ—Ç | ‚Äî |
| 12 | `src/app/api/analytics/notify/route.ts` ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ | –®–∞–≥ 11 |
| 13 | `.github/workflows/analytics-weekly.yml` ‚Äî cron job | –®–∞–≥ 7 |
| 14 | –¢–µ—Å—Ç—ã | –í—Å–µ —à–∞–≥–∏ |

---

## 13. –ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç —Ç–µ–±—è (owner)

1. **Google Cloud**: —Å–æ–∑–¥–∞—Ç—å Service Account, –¥–∞—Ç—å –µ–º—É Viewer –¥–æ—Å—Ç—É–ø –∫ GA4 property, —Å–∫–∞—á–∞—Ç—å JSON key
2. **Anthropic**: –ø–æ–ª—É—á–∏—Ç—å API key
3. **Telegram**: —Å–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather, –ø–æ–ª—É—á–∏—Ç—å token + chat_id
4. **Supabase**: –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é (—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é —Å–∫—Ä–∏–ø—Ç)
5. **Vercel**: –¥–æ–±–∞–≤–∏—Ç—å env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
6. **GitHub**: –¥–æ–±–∞–≤–∏—Ç—å secrets –¥–ª—è Actions (`ANALYTICS_CRON_SECRET`)
